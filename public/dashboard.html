<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Intern Progress Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/static/style.css" />
</head>

<body class="bg-gray-100 flex min-h-screen">

    <!-- Sidebar (Fixed Height) -->
    <aside class="w-64 bg-black text-white flex flex-col min-h-screen">
        <div class="p-6 text-2xl font-bold">INTERN PROGRESS</div>
        <nav class="flex-1">
            <ul>
                <li><a href="#" onclick="openDashboard()" class="block p-3 bg-blue-600 rounded m-1">Dashboard</a></li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main id="mainContent" class="flex-1 p-6 space-y-6">

        <!-- Top Search -->
        <div class="flex justify-between items-center bg-white p-4 rounded shadow">
            <h1 class="text-lg font-semibold">Dashboard</h1>
            <input type="text" placeholder="Search here" class="border px-4 py-2 rounded w-1/3">
        </div>

        <!-- Dynamic Progress Cards Section -->
        <div class="grid grid-cols-3 gap-4" id="progress-cards">
            <!-- Dynamically populated cards -->
        </div>

        <!-- Smaller Pie Chart -->
        <div class="bg-white p-4 rounded shadow w-96 mx-auto">
            <h2 class="font-bold text-center">Hire vs Cancel</h2>
            <canvas id="hireCancelChart" width="300" height="300"></canvas>
        </div>

        <!-- Interns List Table (Dynamic) -->
        <div class="bg-white p-4 rounded shadow">
            <h2 class="font-bold mb-3">Live Intern Status</h2>
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="p-2">No.</th>
                        <th class="p-2">Intern ID</th>
                        <th class="p-2">Name</th>
                        <th class="p-2">Email</th>
                        <th class="p-2">Department</th>
                        <th class="p-2">Mentor</th>
                        <th class="p-2">Time</th>
                        <th class="p-2">Completion (%)</th>
                    </tr>
                </thead>
                <tbody id="intern-list">
                    <!-- Data dynamically injected here -->
                </tbody>
            </table>
        </div>

    </main>

    <script src="/static/script.js"></script>
    <script>
        // Initialize Smaller Pie Chart
        const ctx = document.getElementById('hireCancelChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Hired', 'Canceled', 'Pending'],
                datasets: [{
                    data: [54, 20, 26],
                    backgroundColor: ['#2563eb', '#ef4444', '#facc15']
                }]
            },
            options: {
                responsive: false,    // Fixed size
                plugins: { legend: { position: 'bottom' } }
            }
        });

        // Load Intern Data on Page Load
        window.onload = function () {
            fetch('/api/interns')
                .then(res => res.json())
                .then(interns => {
                    const internTable = document.getElementById('intern-list');
                    const progressCards = document.getElementById('progress-cards');

                    internTable.innerHTML = interns.map((intern, index) =>
                        `<tr class="border-b">
                            <td class="p-2">${index + 1}</td>
                            <td class="p-2">${intern.internId}</td>
                            <td class="p-2">${intern.name}</td>
                            <td class="p-2">${intern.email}</td>
                            <td class="p-2">${intern.department || '-'}</td>
                            <td class="p-2">${intern.mentor || '-'}</td>
                            <td class="p-2">${intern.time || '-'}</td>
                            <td class="p-2 text-green-600">${intern.percent || '0'}%</td>
                        </tr>`
                    ).join('');

                    progressCards.innerHTML = interns.map(intern =>
                        `<div class="bg-white p-4 rounded shadow">
                            <h3 class="font-semibold">${intern.name}</h3>
                            <p><strong>Intern ID:</strong> ${intern.internId}</p>
                            <p><strong>Completion:</strong> ${intern.percent || 0}%</p>
                        </div>`
                    ).join('');
                })
                .catch(err => {
                    console.error(err);
                    document.getElementById('intern-list').innerHTML = '<tr><td colspan="8" class="p-4 text-red-600">Failed to load intern data.</td></tr>';
                });
        };
    </script>
</body>

</html>
